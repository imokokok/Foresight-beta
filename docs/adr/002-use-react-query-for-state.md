# ADR-002：使用 React Query 管理服务端状态

## 状态

已接受

## 日期

2024-01-01

## 背景

前端应用需要管理复杂的数据获取和缓存逻辑。传统的方式是在组件内部使用 `useEffect` 和 `useState`，这种方式存在以下问题：

- 重复请求相同数据
- 难以处理加载、错误、缓存状态
- 竞态条件处理复杂
- 缺乏自动重试和乐观更新

## 决策

采用 React Query（现 TanStack Query）作为服务端状态管理方案。

## 原因

1. **开箱即用的缓存**：自动缓存管理，支持配置缓存时间和 stale 状态
2. **后台更新**：数据在后台自动刷新，确保用户始终看到最新数据
3. **乐观更新**：支持乐观更新，提升用户交互体验
4. **错误重试**：自动重试失败请求
5. **开发工具**：优秀的 DevTools，便于调试和监控
6. **类型安全**：完全 TypeScript 支持

## 替代方案

- **SWR**：Vercel 出品，功能类似，但生态相对较小
- **Apollo Client**：功能强大但重量级，适合 GraphQL
- **Redux Toolkit + RTK Query**：需要引入整个 Redux 生态系统
- **自实现**：完全控制但需要大量维护工作

## 后果

### 正面

- 减少大量重复代码
- 提升用户体验（加载状态、错误处理）
- 更好的性能（缓存、后台更新）
- 便于调试和监控

### 负面

- 增加依赖
- 需要团队学习成本
- 对于简单场景可能过度设计
